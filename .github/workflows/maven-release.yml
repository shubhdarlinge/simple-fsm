name: Publish Release to Maven

on:
  release:
    types: [ published ]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Test
        run: echo "Running now... Tag=${{github.ref_name}}"
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          ref: ${{github.ref_name}}
          fetch-depth: '0'
      - name: Check last git commit
        run: git --no-pager log -n 5 --pretty=oneline
      - name: Update version and create pull request
        run: |
          git config user.name 'shubhdarlinge'
          git config user.email 'shubh.darlinge@gmail.com'
          mvn org.codehaus.mojo:versions-maven-plugin:2.12.0:set -DnewVersion=1.5
          git add pom.xml
          git commit -m "Upgrades project version to 1.5"
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          title: Version upgrade
          body: auto-generated PR
          reviewers: shubhdarlinge
          base: ${{ github.event.repository.default_branch }}
